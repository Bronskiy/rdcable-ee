/*!
 * ExpressionEngine - by EllisLab
 *
 * @package		ExpressionEngine
 * @author		EllisLab Dev Team
 * @copyright	Copyright (c) 2003 - 2016, EllisLab, Inc.
 * @license		https://expressionengine.com/license
 * @link		https://ellislab.com
 * @since		Version 3.0
 * @filesource
 */
$(document).ready(function(){function e(a,n,i){$("div.box",a).html(n),EE.cp.formValidation.init(a),$("form",a).off("submit").on("submit",function(){return $.ajax({type:"POST",url:this.action,data:$(this).add('input[name="categories[]"]').serialize()+"&save_modal=yes",dataType:"json",success:function(n){"success"==n.messageType?(a.trigger("modal:close"),t(i,n.body)):e(a,n.body,i)}}),!1})}function t(e,t){var s=e.parents("fieldset").find(".setting-field"),o=a(e.data("groupId"));s.html(t),i($(".nestable",s)),n(e.data("groupId"),o),EE.cp.addLastToChecklists()}function a(e){var t=$('div[data-nestable-group="'+e+'"] ul.nested-list li input[type="checkbox"]:checked');return $.map(t,function(e){return $(e).val()})}function n(e,t){$.each(t,function(t,a){$('div[data-nestable-group="'+e+'"] input[value="'+a+'"]').prop("checked",!0).trigger("change")})}function i(e){var e=e||".nestable";$(e).nestable({listNodeName:"ul",listClass:"nestable-list",itemClass:"nestable-item",rootClass:"nestable",dragClass:"drag-tbl-row.nested-list",handleClass:"list-reorder",placeElement:$('<li><div class="tbl-row drag-placeholder"><div class="none"></div></div></li>'),expandBtnHTML:"",collapseBtnHTML:"",maxDepth:10,constrainToRoot:!0}).on("change",function(){0!=EE.category.manage_categories_toggle&&(EE.cp.addLastToChecklists(),$.ajax({url:EE.category.reorder.URL.replace("###",$(this).data("nestable-group")),data:{order:$(this).nestable("serialize")},type:"POST",dataType:"json"}))})}"y"==EE.category.auto_assign_parents&&$("body").on("click",'input[name^="categories"]:checkbox',function(){$(this).is(":checked")||$(this).parents("li").first().find("input:checkbox").prop("checked",!1).trigger("change"),$(this).is(":checked")&&$(this).parents("li").find("> label input:checkbox").prop("checked",!0).trigger("change")}),$("body").on("click",".toggle-tools a.toggle-btn",function(e){e.preventDefault();var t=$(this).parents(".nestable"),a=$(this).hasClass("off"),n=$(".list-reorder",t),i=$(".toolbar",t);EE.category.manage_categories_toggle=a,$(this).toggleClass("off",!a),$(this).toggleClass("on",a),$(".form-ctrls button").toggleClass("disable",a),$("input[type=checkbox]",t).prop("disabled",a),a?(n.clearQueue().animate({"margin-left":"-10px"},400),i.stop().fadeIn()):(n.clearQueue().animate({"margin-left":"-50px"},400),i.stop().fadeOut())}),$("body").on("click","a[rel=modal-checkboxes-edit]",function(t){var a,n=$(this),i=n.attr("rel"),s=$("."+i),o=n.parents("fieldset").find("a.toggle-btn").hasClass("on"),l=$(this).data("groupId");o&&(l+="/editing"),a=EE.category.add.URL.replace("###",l),$("div.box",s).html('<p align="center"><a class="btn work" href="">Loading</a></p>'),$(this).data("contentId")&&(a=EE.category.edit.URL.replace("###",$(this).data("groupId")+"/"+$(this).data("contentId"))),$.ajax({type:"GET",url:a,dataType:"html",success:function(t){e(s,t,n),void 0===n.data("contentId")&&$("input[name=cat_name]",s).bind("keyup keydown",function(){$(this).ee_url_title("input[name=cat_url_title]")})}})}),$("body").on("click","a[rel=modal-checkboxes-confirm-remove]",function(e){var a=$("."+$(this).attr("rel")),n=$(this);$(".checklist",a).html("").append("<li>"+$(this).data("confirm")+"</li>"),$('input[name="categories[]"]',a).val($(this).data("contentId")),$("form",a).off("submit").on("submit",function(){return $.ajax({type:"POST",url:this.action,data:$(this).serialize(),dataType:"json",success:function(e){"success"==e.messageType&&(a.trigger("modal:close"),t(n,e.body))}}),!1}),e.preventDefault()}),i()});